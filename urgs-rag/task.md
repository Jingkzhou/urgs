# 全息 RAG + 知识工程 Task 计划

## 目标
- 提升检索精准度、回答建设性与可解释性。
- 建立可评估、可运营、可持续优化的 RAG 体系。

## 范围
- 覆盖数据处理、索引与检索、答案生成、评估与运营闭环。

## 里程碑
- M0：基线评估与问题画像完成
- M1：检索侧优化完成（混合检索、过滤、rerank）
- M2：生成侧优化完成（结构化回答、证据绑定）
- M3：评估与监控闭环上线

## 任务清单

### P0（必须做）
- [ ] T0.1 基线评估集构建：收集 50-100 条典型问题与标准答案
  - 产出：`eval_set.json`、评测维度说明
  - 验收：具备“命中率、正确率、可用率”初始指标
  - 子任务：
    - [ ] 访谈业务侧，汇总高频问题与口径解释类问题
    - [ ] 选取 5-10 份代表性报表/制度/流程文档
    - [ ] 编制问题-标准答案-证据来源三元组
    - [ ] 定义评测维度与评分标准（准确性/可用性/可解释性）
- [ ] T0.2 答案生成补齐（`QAService`）
  - 产出：结构化回答模板 + 证据绑定逻辑
  - 验收：回答包含“结论/证据/建议/边界/澄清”字段
  - 子任务：
    - [ ] 设计结构化回答 schema（JSON 字段定义）
    - [ ] 增加 Answerability Check（证据不足触发澄清）
    - [ ] 生成提示词与证据绑定规则
    - [ ] 增加回答置信度计算与回传
- [ ] T0.3 `k` 参数与真实分数回传
  - 产出：API 使用真实 Top-k 与相似度/置信度
  - 验收：前后端可控调参且可比对效果
  - 子任务：
    - [ ] Query API 透传 `k` 并应用到检索层
    - [ ] 统一 score 定义（向量/关键词/重排序）
    - [ ] 返回 `confidence` 字段与 score 明细

### P1（高优先）
- [ ] T1.1 DocLoader 清洗流程恢复与强化
  - 产出：去噪、表格结构化、OCR 清洗的稳定输出
  - 验收：样本文档清洗前后对比质量提升
  - 子任务：
    - [ ] 梳理清洗策略开关与阈值
    - [ ] 针对 PDF/OCR 与 Excel 表格建立最小可用清洗链
    - [ ] 增加清洗前后样本对比日志与质检样例
- [ ] T1.2 父子文档语义重构
  - 产出：父块保持完整语义，子块用于检索
  - 验收：检索返回包含完整上下文
  - 子任务：
    - [ ] 调整切分流程，确保 Parent 不被过度切分
    - [ ] Parent-Child 元数据映射规则统一
    - [ ] 回答来源引用 Parent 作为证据
- [ ] T1.3 BM25 分库/过滤能力
  - 产出：按 `collection_name` 或元数据过滤的 BM25
  - 验收：跨库检索不串库
  - 子任务：
    - [ ] 设计 BM25 索引生命周期（按 collection）
    - [ ] 将过滤条件下沉到检索阶段
    - [ ] 清理/重建 BM25 索引的运维入口
- [ ] T1.4 Rerank 引入（二阶段排序）
  - 产出：Cross-Encoder 或 BGE-reranker 集成
  - 验收：评测集 Top-3 命中率提升
  - 子任务：
    - [ ] 选型 reranker 模型与部署方式
    - [ ] 接入 Top-N rerank 并输出新排序
    - [ ] 记录 rerank 前后对比指标

### P2（中优先）
- [ ] T2.1 意图识别与路由
  - 产出：问题类型识别（定义/流程/SQL/血缘）
  - 验收：不同意图路由至不同知识集
  - 子任务：
    - [ ] 定义意图类别与路由规则
    - [ ] 新增意图识别提示词或规则模型
    - [ ] 记录意图分布与误判样例
- [ ] T2.2 知识增强补齐（摘要/关键词/场景标签）
  - 产出：摘要索引、关键词元数据过滤
  - 验收：概览类问题命中率提升
  - 子任务：
    - [ ] 设计摘要生成策略与存储结构
    - [ ] 关键词/场景标签抽取与入库
    - [ ] 对摘要索引与标签做过滤测试
- [ ] T2.3 Answerability Check
  - 产出：低证据场景触发澄清问题
  - 验收：低置信问答比例下降
  - 子任务：
    - [ ] 定义置信阈值与触发规则
    - [ ] 生成澄清问题模板
    - [ ] 增加低置信记录与回溯入口

### P3（持续优化）
- [ ] T3.1 离线评估自动化（RAGAS）
  - 产出：评估脚本与指标报表
  - 验收：每次优化可自动回归
  - 子任务：
    - [ ] 引入评估脚本与数据输入规范
    - [ ] 形成基线报告与回归流程
- [ ] T3.2 在线监控与反馈闭环
  - 产出：满意度、命中率、低置信率监控
  - 验收：低质量问题可追踪与回收
  - 子任务：
    - [ ] 设计在线指标埋点与上报字段
    - [ ] 构建异常问题回收清单
- [ ] T3.3 文档与运维流程
  - 产出：上线与回滚指引、数据更新流程
  - 验收：新数据可按流程入库并可追溯
  - 子任务：
    - [ ] 编写上线/回滚 Checklist
    - [ ] 编写数据更新与索引重建流程

## 依赖与风险
- LLM 配置稳定性与 Token 成本控制。
- 评测集质量决定优化方向准确性。
- Rerank 模型性能与成本需要权衡。

## 交付标准（DoD）
- 功能：结构化回答、证据绑定、检索可控。
- 质量：Top-3 命中率与满意度有可量化提升。
- 运营：具备评估脚本与监控指标。
