# 变更记录 - 2025-12-27

## 1. 变更摘要
- **后端接口**: 更新 `WorkflowController`, `WorkflowService` 以支持 `systemId` 保存。
- **前端页面**: 更新 `WorkflowDefinition.tsx` 增加必填的“关联系统”选择框及列表展示。
- **数据库规范**: 新增 `V10`, `V11`, `V12` 迁移脚本；建立 `db-migration` 管理工作流。
- **任务管理**: 任务定义与任务实例新增“所属系统”字段显示及关联功能。
- **调度管理 UI 重设计**: 新增统计卡片区、列表/卡片双视图模式、现代化样式优化。
- **AI 辅助生成**: 发布台账新增“AI 智能格式化”功能，自动生成专业版本说明。
- **Bug 修复**: 修复了 `t_deployment` 缺少 `strategy_id` 导致的 SQL 异常。
- **版本维护**: 建立自动化版本记录管理规范。

## 2. 影响范围
### 修改文件列表:
```text
A	docs/release-notes/v5.0.0-version-management.md
M	urgs-api/src/main/java/com/example/urgs_api/user/model/User.java
A	urgs-api/src/main/java/com/example/urgs_api/version/controller/AICodeAuditController.java
A	urgs-api/src/main/java/com/example/urgs_api/version/controller/VersionStatsController.java
M	urgs-api/src/main/java/com/example/urgs_api/version/controller/WebhookController.java
A	urgs-api/src/main/java/com/example/urgs_api/version/dto/DeveloperKpiVO.java
A	urgs-api/src/main/java/com/example/urgs_api/version/entity/AICodeReview.java
A	urgs-api/src/main/java/com/example/urgs_api/version/repository/AICodeReviewRepository.java
A	urgs-api/src/main/java/com/example/urgs_api/version/service/CodeReviewService.java
A	urgs-api/src/main/java/com/example/urgs_api/version/service/VersionStatsService.java
A	urgs-api/src/main/java/com/example/urgs_api/version/service/impl/CodeReviewServiceImpl.java
A	urgs-api/src/main/java/com/example/urgs_api/version/service/impl/VersionStatsServiceImpl.java
A	urgs-api/src/main/resources/db/migration/V5__Version_Management_Enhancement.sql
M	urgs-web/src/api/version.ts
M	urgs-web/src/components/VersionManagement.tsx
M	urgs-web/src/components/version/AICodeAudit.tsx
M	urgs-web/src/components/version/ReleaseStats.tsx
M	urgs-web/src/utils/request.ts
M	urgs-api/src/main/java/com/example/urgs_api/workflow/entity/Workflow.java
M	urgs-api/src/main/java/com/example/urgs_api/workflow/controller/WorkflowController.java
M	urgs-api/src/main/java/com/example/urgs_api/workflow/service/WorkflowService.java
M	urgs-web/src/components/ops/schedule/WorkflowDefinition.tsx
A	urgs-api/src/main/resources/db/migration/V10__Add_SystemId_To_Workflow.sql
A	.agent/workflows/db-migration.md
A	.agent/workflows/release-notes.md
M	urgs-api/src/main/java/com/example/urgs_api/task/entity/Task.java
M	urgs-api/src/main/java/com/example/urgs_api/task/entity/TaskInstance.java
M	urgs-api/src/main/java/com/example/urgs_api/task/service/TaskService.java
M	urgs-api/src/main/java/com/example/urgs_api/workflow/service/WorkflowService.java
M	urgs-api/src/main/java/com/example/urgs_api/task/controller/TaskController.java
M	urgs-web/src/components/ops/schedule/TaskDefinition.tsx
M	urgs-web/src/components/ops/schedule/TaskInstance.tsx
A	urgs-api/src/main/resources/db/migration/V11__Add_SystemId_To_Task_And_Instance.sql
A	urgs-api/src/main/resources/db/migration/V12__Fix_Release_And_Deployment_Schema.sql
M	urgs-api/src/main/java/com/example/urgs_api/version/service/ReleaseRecordService.java
M	urgs-api/src/main/java/com/example/urgs_api/version/controller/ReleaseRecordController.java
M	urgs-web/src/components/version/ReleaseLedger.tsx
M	urgs-web/src/api/version.ts

```

### 业务影响:
- **工作流管理**: 现要求工作流必须关联具体系统，提升了运维数据的关联度。
- **自动化部署**: 数据库变更现已版本化，支持自动迁移。
- **变更记录**: 规范了版本维护流程，确保每次需求都有迹可循。

## 3. 验证情况
- [x] 代码变更已同步
- [ ] 本地自测已通过
- [ ] 关键路径回归已完成

## 4. 回滚方案
- 回滚命令: `git revert HEAD`
