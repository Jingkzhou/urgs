# v5.0.0 - 版本管理系统升级

**发布日期：** 2025-12-27
**作者：** Antigravity (AI Assistant)

## 摘要
为了实现对项目系统和开发人员 KPI 的全面管理，版本管理模块进行了升级。本次发布包含了 AI 代码自动走查、开发者 KPI 统计以及用户与 GitLab 账号自动映射等核心功能。

## 变更日志 (Change Log)

### 1. 业务需求变更 (Non-Technical)
*   **绩效考核标准升级**：响应项目组管理要求，正式将“代码质量评分”纳入开发人员月度绩效考核指标；同时调整了发布审批流程，紧急发布需经过架构师复核。

### 2. 数据库变更
*   **Schema 更新**：`V5__Version_Management_Enhancement.sql`
*   **`sys_user`**：新增 `email` 和 `gitlab_username` 字段，用于将系统用户与 Git 提交作者进行自动关联。
*   **`ver_ai_code_review`**：新增表结构，用于存储 AI 生成的代码审查结果、评分及状态。

### 3. 后端功能 (`urgs-api`)
*   **用户映射**：更新了 `User` 实体，支持通过邮箱将系统用户映射到 GitLab 账号。
*   **AI 代码走查模块**：
    *   `AICodeAuditController`：新增用于触发和获取代码审查记录的接口。
    *   `CodeReviewService`：实现了从 Webhook 触发审查并将 Commit 映射到用户的核心逻辑。
    *   `AICodeReviewRepository`：审查记录的持久层接口。
*   **开发者 KPI**：
    *   `VersionStatsController`：新增接口用于查询开发者统计数据（提交数、审查数、质量评分）。
    *   `VersionStatsService`：实现了聚合 AI 审查数据和 Commit 数据的逻辑。
*   **Webhook 增强**：更新了 `WebhookController` 以解析 `push` 事件，提取 Commit 和作者信息，并自动触发 AI 审查流程。

### 4. 前端功能 (`urgs-web`)
*   **新增模块**：
    *   `AICodeAudit`：专用的 AI 审查页面，用于查看审查日志和详细的分析报告。
    *   `ReleaseStats`：团队绩效仪表盘，展示 KPI 指标和“贡献度排行”。
*   **集成**：
    *   更新 `VersionManagement.tsx`，将新模块加入到导航 Tab 中。
    *   更新 `api/version.ts`，增加了新的 API 定义。
*   **工具类**：优化了 `request.ts` 的类型安全，支持更灵活的参数处理。

## 部署说明
1.  **数据库**：执行 Flyway 迁移脚本 `V5__Version_Management_Enhancement.sql`。
2.  **配置**：确保系统用户的 `email` 字段已填充，且与 Git 提交时的邮箱一致。
3.  **Webhook**：配置 GitLab 仓库的 Webhook 指向 `/api/webhook/gitlab/{repoId}`。
