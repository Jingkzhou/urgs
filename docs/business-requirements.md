# URGS 业务需求说明书

## 1. 背景与目标
- 提供统一的监管门户、资源整合与调度平台，覆盖任务编排、元数据与血缘治理、知识库与智能问答、版本与运维可视化，并将 AI 深度融入各核心模块。
- 支撑监管类业务多系统、多团队协同，降低变更风险与运维成本，提升交付与合规效率。
- 全链路能力：前端门户 (React)、核心后端 (Spring Boot)、执行器集群、RAG 智能服务、SQL 血缘解析引擎，并通过场景化 AI 智能体（如1104填报助手，一表通报送内容分析助手）提供检索增强、智能建议与自动化操作触发。

## 2. 范围与不在范围
- 在范围：任务/工作流调度、执行监控、元数据与血缘管理、知识库与智能问答、系统与权限、版本与发布管理、公告、运维问题登记、基础设施监控、AI 能力管理。
- 不在范围：具体业务系统功能开发、第三方 CMDB 建设、费用计费、硬件采购。

## 3. 用户与角色
- 超级管理员：平台参数、全局权限、敏感操作。
- 系统管理员：机构/用户/角色/菜单、数据源、AI 配置、公告、基础设施监控。
- 研发/运维：调度编排、版本发布、流水线、部署、日志、运维问题登记。
- 数据治理：元数据模型、资产、代码目录、血缘管理。
- 普通业务用户：查看公告、看板、知识库浏览与文档维护、Ark 助手对话。

## 4. 顶层功能导航（基于前端权限清单）
### 4.1 工作台 (dashboard)
- 主页分区：系统跳转区（常用监管系统快捷入口）、统计分析区（任务成功率、延迟、失败 TOP5 等可配置指标）、公告查看（支持置顶与弹窗策略）、批量监控（多实例健康状态）。
- 角色视角：
  - 业务人员：快捷入口（监管系统/版本发布台账/公告）、系统数据治理及自动化情况监控、公告提醒、版本变更通知、问题登记入口。
  - 研发人员：研发工作台卡片（流水线监控：构建/部署阶段状态、耗时、失败原因），错误日志（按系统/时间/级别过滤）、API 状态（健康探针、响应时间、失败率）、一键跳转代码/流水线。
  - 运维人员：批量监控（多实例健康、心跳、异常 TOP）、调度列表快捷入口、任务失败/超时告警、执行器节点状态、Docker/基础设施日志入口。
- 快捷操作：一键进入调度列表、版本发布台账、问题登记；支持按角色个性化卡片开关与排序。
- 数据来源：调度中心指标、执行器心跳、版本发布流水线、日志采集、公告服务；要求接口响应 < 1s、卡片异步刷新。
- 监管日历：展示业务强关联节点（如“1104 报送倒计时”“人行数源报送截止日”），按日/周/月视图聚合；支持与任务/报送系统/知识库链接联动，提供提醒与超期高亮，而非简单跳转入口。

### 4.2 Ark 助手 (ark)
- 入口：/ark，承载对话、RAG 检索增强与资料引用展示，支持多助手（AI 智能体）按业务场景配置。
- 能力：流式对话、参考资料实时推送、上下文压缩、会话历史留存；支持绑定知识库/数据资产/血缘信息，结合混合检索 (BM25/语义/逻辑) 返回引用。
- 助手管理：后端可为不同角色/场景创建专属 Agent（如调度故障助手、发布合规助手、数据血缘助手），配置 System Prompt、调用的 API、检索的 Collection。
- 未来收益：
  - 降本增效：减少人工检索文档和排障时间，缩短问题定位与处理耗时。
  - 知识沉淀：通过知识库与对话记录累积组织经验，支持持续迭代。
  - 风险防控：在调度、发布、血缘分析等关键操作提供上下文建议与提醒，降低误操作与合规风险。
  - 可扩展：后续可接入多模型、工具调用（如触发查询、执行诊断脚本）和权限感知回答。

### 4.3 公告管理 (announcement)
- 公告列表；发布、编辑、删除公告。重点支持监管报送相关发文/公告通知：
  - 分类与标签：支持按“监管发文/制度更新/临时通知/运维公告”分类，标签化检索。
  - 强提醒：置顶、弹窗、定向推送（按机构/角色/系统），可设置有效期与生效范围。
  - 合规留痕：公告版本记录、发布人/发布时间、已读回执与未读名单导出。
  - 关联业务：可挂载相关报送系统、调度任务、数据资产或知识库文档链接，便于快速定位影响范围。

### 4.4 系统管理 (sys)
- 机构管理：查询/新增/编辑/删除。
- 角色管理：查询/新增/编辑/删除。
- 用户管理：查询/新增/编辑/删除。
- 菜单功能管理：动态捕捉、增改删。
- 监管系统管理：查询、增改删配置。
- 数据源配置：查询。
- AI 管理：
  - API 管理：查询、增改删；维护可调用的大模型/外部 API 列表，配置调用域名、鉴权方式（Key/Token/AKSK）、模型规格与费用上限，支持连通性/延迟健康检查与调用审计。
  - 助手管理：查询、增改删；为不同业务/运维场景创建 AI 智能体，配置 System Prompt、绑定 API、知识库 Collection、可调用工具/函数（如查询、诊断脚本、调度操作），可控的上下文窗口与安全策略（敏感字段脱敏、回复黑名单）。
  - 知识库管理：查询、增改删；上传/导入文档与结构化资产，自动向量化与分片，支持标签/目录/版本管理，设置检索策略（BM25/语义/逻辑权重）、停用词、Top-K，上下线与回滚，索引重建与质量评估。
- Docker 管理：日志管理（查询容器、查看/下载日志）。

### 4.5 版本管理 (version)
- 应用系统库、Git 仓库管理、流水线管理（创建、触发执行），支持按环境（DEV/UAT/PROD）与分支/Tag 绑定，触发自动化构建与部署。
- 部署管理：多环境发布、灰度/蓝绿/回滚策略、窗口与审批校验；发布单与部署记录联动。
- 版本发布台账：版本登记、一键回滚（快速选择最近可用版本），关联发布单、部署记录、流水线运行日志，通知干系人系统升级内容，支持发布单关联。
- AI 智查报告：触发走查（代码/配置/依赖/SQL/脚本），输出风险等级、证据片段、修复建议，支持下载审计报告并在发布前作为阻断/提醒条件；可关联特定 AI 智能体负责巡检。
- 变更事前阻断：当开发修改基础表字段类型/含义时，系统基于血缘图谱自动检测下游是否存在监管关键报表依赖该字段，流水线自动触发红灯警告或强制二级审批（而非仅展示血缘图），确保高风险变更先评估后发布。
- 发布数据统计：按系统/环境/时间维度统计发布频次、失败率、平均恢复时间，支持导出。

### 4.6 数据管理 (metadata)
- 物理模型：同步元数据，生成表/字段字典，为取数规则提供基线。
- 资产管理：
  - 监管资产：增删改、导入导出、字段维护、同步逻辑、生成脚本；支持监管报送指标自动化取数，通过 AI 转换代码为自然语言描述，让业务了解这个指标到底是怎么算出来的，监管发文填报规则，保存执行版本与审计日志。
  - 监管集市表/字段与取数逻辑：线上化管理，关联指标口径、发文条款、依赖表字段、过滤/汇总逻辑，支持变更对比与发布。
  - 代码值域：增删改、导入导出代码/值域；线上化管理值域版本与生效范围，提供引用关系视图。
  - 维护记录：导出、新增、编辑、删除；记录人/时间/内容全链路留痕，可追溯变更对依赖资产的影响。
- 血缘管理：血缘溯源、影响分析；血缘引擎启动/重启/停止/查看日志。技术方案：多方言 SQL 解析 + 字段级血缘图（Neo4j/图存储），支持表/字段上下游追踪、影响面分析、取数链路可视化，服务于取数规则校验、发布影响评估。

### 4.7 运维管理 (ops)
- 调度管理（原 4.4）：新建调度、刷新状态、工作流管理（定义/实例）、任务管理（定义/实例）。
- 生产问题登记：增删改查；问题解决后支持“一键转知识库”，由 AI 自动总结为“现象-原因-解决方案”三段式文档，入库 Knowledge Base，形成可检索的运维资产。
- 基础设施管理：设备/节点可视化与状态。

### 4.8 知识中心 (knowledge)
- 全部文档：新建/编辑/删除。
- 文件夹管理：新建/删除。
- 标签管理：新建/删除。

## 5. 业务流程概要
- 元数据与血缘：数据源配置 → 元数据同步 → 模型/资产/代码目录维护 → SQL 血缘解析 → 血缘图查询与影响分析。
- RAG 智能问答：前端 Ark 发送会话 → API 查询 Agent 配置 → 触发 RAG 混合检索 → 推送参考资料 → 上下文组装 → LLM 流式输出 → 历史与来源持久化。
- 版本与发布：版本登记 → 关联 Git 仓库与流水线 → 部署记录 → AI 走查报告 → 发布统计。
- 公告与知识中心：公告发布后工作台展示；知识库支撑团队文档沉淀与标签化。
- 运维问题登记：问题创建→跟踪→关闭，支撑事后分析与公告转译。
