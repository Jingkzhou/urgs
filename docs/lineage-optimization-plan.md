# 血缘性能优化改造计划

目标：针对血缘查询与导出卡顿问题，从低风险到高收益逐步改造，确保可控、可回滚、可量化。

## 阶段一：梳理与量化（必做）
- 统计图谱、影响分析、追溯、导出的默认参数与前端传参路径
- 采集典型大表的节点数/边数/耗时，标记最慢的接口与查询
- 明确当前深度策略、版本过滤位置、以及是否存在全量导出

## 阶段二：低风险查询优化
- 降低默认 depth，增加 maxNodes/maxEdges 上限与截断提示
- 导出接口要求显式 depth，避免默认全量深度
- 记录截断与分页提示，保证前端可感知

## 阶段三：索引与查询改写
- 统一表名/字段名大小写策略，去掉 toLower/CONTAINS 全表扫描
- 增加 Table/Column 索引与必要约束
- 将版本过滤提前到关系模式，避免先扩再筛

## 阶段四：高阶优化选项
- 评估 APOC subgraphAll/BFS 替代路径枚举
- 针对热点查询引入缓存（按表名+深度+版本）
- 如有需要，拆分图谱为版本分片

## 阶段五：验证与回归
- 在大血缘数据集上对比耗时、节点数、导出时长
- 验证功能结果一致性与前端体验

## 优化建议优先级（由高到低）
1. 限制默认 depth，增加 maxNodes/maxEdges 截断与提示
2. 导出接口显式 depth，避免默认全量图谱构建
3. 统一大小写策略，去掉 toLower/CONTAINS 全表扫描
4. 增加 Table/Column 索引与必要约束
5. 版本过滤前置到关系模式（避免先扩再筛）
6. APOC subgraphAll/BFS 替代路径枚举
7. 热点查询缓存与版本分片（视数据规模与访问模式决定）
